<!-- Licensed under GPLv3 - See LICENSE file for details. -->
{% load filter %}
<form id="schedule-portal-form" class="calcite-form" autocomplete="off" aria-label="Schedule portal updates">
  {% csrf_token %}
  <calcite-input type="text" id="{{ form.instance.name }}" name="{{ form.instance.name }}"
                 placeholder="Portal Alias" read-only
                 autocomplete="off" value="{{ form.instance.value }}" label-text="Portal Alias"
                 required label="Portal Alias"
                 status="{% if form.instance.errors %}invalid{% else %}idle{% endif %}"
                 validation-message="{{ form.instance.errors|join:' ' }}"
                 validation-icon="{% if form.instance.errors %}exclamation-mark-triangle{% endif %}"></calcite-input>

  <div class="flex-container flex-column-gap-1">
    <div class="width-50">
      <calcite-input-date-picker id="beginning-on" name="beginning_on"
                                 value="{% if form.beginning_on.value|format_date %}{{ form.beginning_on.value|format_date }}{% else %}{% now "Y-m-d" %}{% endif %}"
                                 label-text="Beginning On" required label="Beginning On"
                                 min="{% now "Y-m-d" %}">
        <calcite-icon slot="label-content" id="beginning-on-tooltip" icon="information" scale="s"></calcite-icon>
      </calcite-input-date-picker>
      <calcite-input-message {% if not form.beginning_on.errors %}hidden{% endif %}
                             icon="exclamation-mark-triangle-f" status="invalid">
        {{ form.beginning_on.errors|join:" " }}
      </calcite-input-message>
    </div>
    <div class="width-50">
      <calcite-select name="{{ form.repeat_type.name }}" id="repeat-type" value="{{ form.repeat_type.value }}"
                      label-text="Repeat Type" label="Repeat Type" required
                      status="{% if form.repeat_type.errors %}invalid{% else %}idle{% endif %}"
                      validation-message="{{ form.repeat_type.errors|join:' ' }}"
                      validation-icon="{% if form.repeat_type.errors %}exclamation-mark-triangle{% endif %}">
        <calcite-icon slot="label-content" id="repeat-type-tooltip" icon="information" scale="s"></calcite-icon>
        <calcite-option value="minute" label="Every Minute">Minute</calcite-option>
        <calcite-option value="hour" label="Every Hour">Hour</calcite-option>
        <calcite-option value="day" label="Every Day">Day</calcite-option>
        <calcite-option value="week" label="Every Week">Week</calcite-option>
        <calcite-option value="month" label="Every Month">Month</calcite-option>
      </calcite-select>
    </div>
  </div>

  <div id="repeat-minute" hidden>
    <div class="">
      <calcite-select id="repeat-interval-minute" name="repeat_interval_minute"
                      value="{{ form.repeat_interval_minute.value }}" label-text="Repeat Interval" required
                      status="{% if form.repeat_interval_minute.errors %}invalid{% else %}idle{% endif %}"
                      validation-message="{{ form.repeat_interval_minute.errors|join:' ' }}"
                      validation-icon="{% if form.repeat_interval_minute.errors %}exclamation-mark-triangle{% endif %}"
                      label="Repeat Interval">
        <calcite-icon slot="label-content" id="repeat-interval-minute-tooltip" icon="information"
                      scale="s"></calcite-icon>
        <calcite-option value="15" label="Every 15 minutes">15 - Every fifteen minutes</calcite-option>
        <calcite-option value="30" label="Every 30 minutes">30 - Every thirty minutes</calcite-option>
      </calcite-select>
    </div>

    <fieldset id="days-of-week-minute-fieldset" role="group" aria-labelledby="days-of-week-minute-legend">
      <calcite-label layout="inline-space-between">On Days
        <calcite-icon id="days-of-week-minute-tooltip" icon="information" scale="s"></calcite-icon>
      </calcite-label>
      <div class="flex-container flex-justify-between">
        {% for value, label in form.fields.day_of_week_minute.choices %}
          <calcite-checkbox name="day_of_week_minute" value="{{ value }}"
            {% if value in form.day_of_week_minute.value %}checked{% endif %} label-text="{{ label }}"></calcite-checkbox>
        {% endfor %}
      </div>
      <calcite-input-message {% if not form.day_of_week_minute.errors %}hidden{% endif %}
                             icon="exclamation-mark-triangle-f" status="invalid">
        {{ form.day_of_week_minute.errors|join:" " }}
      </calcite-input-message>
    </fieldset>

    <fieldset id="between-hours-minute-fieldset" class="display-grid">
      <calcite-label alignment="start" layout="default">
        <div class="flex-container flex-align-center flex-justify-between">
          Between Hours
        <calcite-label layout="inline" class="no-margin-bottom">
          All Day
          <calcite-switch id="all-day-minute" checked scale="m" label="Run all day"></calcite-switch>
        </calcite-label>
        </div>
      </calcite-label>
      <div class="flex-container flex-align-center">
        <calcite-input-time-picker disabled id="between-hours-start-minute" name="between_hours_start_minute"
                                   class="col-50" label-text="Start Time" label="Start Time"
                                   position="bottom" value="{% if form.between_hours_start_minute.value %}{{ form.between_hours_start_minute.value }}{% else %}00:00{% endif %}"
                                   status="{% if form.between_hours_start_minute.errors %}invalid{% else %}idle{% endif %}"
                                   validation-message="{{ form.between_hours_start_minute.errors|join:' ' }}"
                                   validation-icon="{% if form.between_hours_start_minute.errors %}exclamation-mark-triangle{% endif %}">
        </calcite-input-time-picker>
        <calcite-input-time-picker disabled id="between-hours-end-minute" name="between_hours_end_minute"
                                   class="col-50 margin-inline-start-1" label-text="End Time"
                                   position="bottom" label="End Time"
                                   value="{{ form.between_hours_end_minute.value }}"
                                   status="{% if form.between_hours_end_minute.errors %}invalid{% else %}idle{% endif %}"
                                   validation-message="{{ form.between_hours_end_minute.errors|join:' ' }}"
                                   validation-icon="{% if form.between_hours_end_minute.errors %}exclamation-mark-triangle{% endif %}">
        </calcite-input-time-picker>
      </div>
    </fieldset>
  </div>

  <div id="repeat-hour" hidden>
    <div class="flex-container flex-column-gap-1">
      <div class="width-50">
        <calcite-select id="repeat-interval-hour" name="repeat_interval_hour"
                        value="{{ form.repeat_interval_hour.value }}" label-text="Repeat Interval" required
                        status="{% if form.repeat_interval_hour.errors %}invalid{% else %}idle{% endif %}"
                        validation-message="{{ form.repeat_interval_hour.errors|join:' ' }}" label="Repeat Interval"
                        validation-icon="{% if form.repeat_interval_hour.errors %}exclamation-mark-triangle{% endif %}">
          <calcite-icon slot="label-content" id="repeat-interval-hour-tooltip" icon="information"
                        scale="s"></calcite-icon>
          <calcite-option value="1" label="Every 1 hour">1 - Every one hour</calcite-option>
          <calcite-option value="2" label="Every 2 hours">2 - Every two hours</calcite-option>
          <calcite-option value="3" label="Every 3 hours">3 - Every three hours</calcite-option>
          <calcite-option value="4" label="Every 4 hours">4 - Every four hours</calcite-option>
          <calcite-option value="6" label="Every 6 hours">6 - Every six hours</calcite-option>
          <calcite-option value="12" label="Every 12 hours">12 - Every twelve hours</calcite-option>
        </calcite-select>
      </div>
      <div class="width-50">
        <calcite-select id="on-minute-hour" name="on_minute_hour" value="{{ form.on_minute_hour.value }}"
                        label-text="On Minute" required label="On Minute"
                        status="{% if form.on_minute_hour.errors %}invalid{% else %}idle{% endif %}"
                        validation-message="{{ form.on_minute_hour.errors|join:' ' }}"
                        validation-icon="{% if form.on_minute_hour.errors %}exclamation-mark-triangle{% endif %}">
          <calcite-icon slot="label-content" id="on-minute-tooltip" icon="information" scale="s"></calcite-icon>
          <calcite-option value="0" label="On the hour">0 - (HH:00)</calcite-option>
          <calcite-option value="5" label="5 minutes past">5 - (HH:05)</calcite-option>
          <calcite-option value="15" label="15 minutes past">15 - (HH:15)</calcite-option>
          <calcite-option value="30" label="30 minutes past">30 - (HH:30)</calcite-option>
          <calcite-option value="45" label="45 minutes past">45 - (HH:45)</calcite-option>
        </calcite-select>
      </div>
    </div>

    <fieldset id="days-of-week-hour-fieldset" role="group" aria-labelledby="days-of-week-hour-legend">
      <calcite-label layout="inline-space-between">On Days
        <calcite-icon id="days-of-week-hour-tooltip" icon="information" scale="s"></calcite-icon>
      </calcite-label>
      <div class="flex-container flex-justify-between">
        {% for value, label in form.fields.day_of_week_hour.choices %}
          <calcite-checkbox name="day_of_week_hour" value="{{ value }}" {% if value in form.day_of_week_hour.value %}
                            checked{% endif %} label-text="{{ label }}"></calcite-checkbox>
        {% endfor %}
      </div>
      <calcite-input-message {% if not form.day_of_week_hour.errors %}hidden{% endif %}
                             icon="exclamation-mark-triangle-f" status="invalid">
        {{ form.day_of_week_hour.errors|join:" " }}
      </calcite-input-message>
    </fieldset>

    <fieldset id="between-hours-hour-fieldset">
      <calcite-label alignment="start" layout="default">
        <div class="flex-container flex-align-center flex-justify-between">
          Between Hours
        <calcite-label layout="inline" class="no-margin-bottom">
          All Day
          <calcite-switch id="all-day-hour" checked scale="m" label="Run all day"></calcite-switch>
        </calcite-label>
        </div>
      </calcite-label>
      <div class="flex-container flex-align-center">
        <calcite-input-time-picker disabled id="between-hours-start-hour" name="between_hours_start_hour"
                                   class="col-50" label-text="Start Time" label="Start Time"
                                   position="bottom"
                                   value="{{ form.between_hours_start_hour.value }}"
                                   status="{% if form.between_hours_start_hour.errors %}invalid{% else %}idle{% endif %}"
                                   validation-message="{{ form.between_hours_start_hour.errors|join:' ' }}"
                                   validation-icon="{% if form.between_hours_start_hour.errors %}exclamation-mark-triangle{% endif %}"></calcite-input-time-picker>
        <calcite-input-time-picker disabled id="between-hours-end-hour" name="between_hours_end_hour"
                                   class="col-50 margin-inline-start-1" label-text="End Time"
                                   position="bottom" label="End Time"
                                   value="{{ form.between_hours_end_hour.value }}"
                                   status="{% if form.between_hours_end_hour.errors %}invalid{% else %}idle{% endif %}"
                                   validation-message="{{ form.between_hours_end_hour.errors|join:' ' }}"
                                   validation-icon="{% if form.between_hours_end_hour.errors %}exclamation-mark-triangle{% endif %}">
        </calcite-input-time-picker>
      </div>
    </fieldset>
  </div>

  <div id="repeat-day" hidden>
    <div class="flex-container flex-column-gap-1">
      <div class="width-50">
        <calcite-select id="repeat-interval-day" name="repeat_interval_day" label="Repeat Interval"
                        value="{{ form.repeat_interval_day.value }}" label-text="Repeat Interval" required
                        status="{% if form.repeat_interval_day.errors %}invalid{% else %}idle{% endif %}"
                        validation-message="{{ form.repeat_interval_day.errors|join:' ' }}"
                        validation-icon="{% if form.repeat_interval_day.errors %}exclamation-mark-triangle{% endif %}">
          <calcite-icon slot="label-content" id="repeat-interval-day-tooltip" icon="information"
                        scale="s"></calcite-icon>
          <calcite-option value="1" label="Every day">1 - Every day</calcite-option>
          <calcite-option value="2" label="Every 2 days">2 - Every two days</calcite-option>
          <calcite-option value="3" label="Every 3 days">3 - Every three days</calcite-option>
          <calcite-option value="4" label="Every 4 days">4 - Every four days</calcite-option>
          <calcite-option value="5" label="Every 5 days">5 - Every five days</calcite-option>
          <calcite-option value="6" label="Every 6 days">6 - Every six days</calcite-option>
          <calcite-option value="7" label="Every week">7 - Every seven days</calcite-option>
          <calcite-option value="14" label="Every 2 weeks">14 - Every fourteen days</calcite-option>
        </calcite-select>
      </div>
      <div class="width-50">
        <calcite-input-time-picker name="time_day" id="time-day" label="Time"
                                   value="{{ form.time_day.value }}" label-text="Time"
                                   required status="{% if form.time_day.errors %}invalid{% else %}idle{% endif %}"
                                   validation-message="{{ form.time_day.errors|join:' ' }}"
                                   validation-icon="{% if form.time_day.errors %}exclamation-mark-triangle{% endif %}">
          <calcite-icon slot="label-content" id="time-day-tooltip" icon="information" scale="s"></calcite-icon>
        </calcite-input-time-picker>
      </div>
    </div>
  </div>

  <div id="repeat-week" hidden>
    <fieldset id="days-of-week-week-fieldset" role="group" aria-labelledby="days-of-week-week-legend">
      <calcite-label layout="inline-space-between">On Days
        <calcite-icon id="days-of-week-week-tooltip" icon="information" scale="s"></calcite-icon>
      </calcite-label>
      <div class="flex-container flex-justify-between">
        {% for value, label in form.fields.day_of_week_week.choices %}
            <calcite-checkbox name="day_of_week_week" value="{{ value }}" {% if value in form.day_of_week_week.value %}
                              checked{% endif %} label-text="{{ label }}"></calcite-checkbox>
        {% endfor %}
      </div>
      <calcite-input-message {% if not form.day_of_week_week.errors %}hidden{% endif %}
                             icon="exclamation-mark-triangle-f" status="invalid">
        {{ form.day_of_week_week.errors|join:" " }}
      </calcite-input-message>
    </fieldset>
    <div id="time-container">
      <calcite-input-time-picker value="{{ form.time_week.value }}" name="time_week"
                                 id="time-week" label-text="Time" required label="Time"
                                 status="{% if form.time_week.errors %}invalid{% else %}idle{% endif %}"
                                 validation-message="{{ form.time_week.errors|join:' ' }}"
                                 validation-icon="{% if form.time_week.errors %}exclamation-mark-triangle{% endif %}">
        <calcite-icon slot="label-content" id="time-week-tooltip" icon="information" scale="s"></calcite-icon>
      </calcite-input-time-picker>
    </div>
  </div>

  <div id="repeat-month" hidden>
    <div class="flex-container flex-column-gap-1">
      <div class="width-50">
        <calcite-select id="repeat-interval-month" name="repeat_interval_month" label="Repeat Interval"
                        value="{{ form.repeat_interval_month.value }}" label-text="Repeat Interval" required
                        status="{% if form.repeat_interval_month.errors %}invalid{% else %}idle{% endif %}"
                        validation-message="{{ form.repeat_interval_month.errors|join:' ' }}"
                        validation-icon="{% if form.repeat_interval_month.errors %}exclamation-mark-triangle{% endif %}">
          <calcite-icon slot="label-content" id="repeat-interval-month-tooltip" icon="information"
                        scale="s"></calcite-icon>
          <calcite-option value="1" label="Every month">1 - Every month</calcite-option>
          <calcite-option value="2" label="Every 2 months">2 - Every two months</calcite-option>
          <calcite-option value="3" label="Every 3 months">3 - Every three months</calcite-option>
          <calcite-option value="4" label="Every 4 months">4 - Every four months</calcite-option>
          <calcite-option value="5" label="Every 5 months">5 - Every five months</calcite-option>
          <calcite-option value="6" label="Every 6 months">6 - Every six months</calcite-option>
        </calcite-select>
      </div>
      <div class="width-50">
        <calcite-input type="number" name="{{ form.day_of_month.name }}" id="day-of-month" min="1" max="31"
                       value="{{ form.day_of_month.value }}" label-text="Day of Month" required
                       number-button-type="vertical" label="Day of Month"
                       status="{% if form.day_of_month.errors %}invalid{% else %}idle{% endif %}"
                       validation-message="{{ form.day_of_month.errors|join:' ' }}"
                       validation-icon="{% if form.day_of_month.errors %}exclamation-mark-triangle{% endif %}">
          <calcite-icon slot="label-content" id="day-of-month-tooltip" icon="information" scale="s"></calcite-icon>
        </calcite-input>
      </div>
    </div>
    <div id="time-container">
      <calcite-input-time-picker value="{{ form.time_month.value }}" name="time_month"
                                 id="time-month" label-text="Time" required label="Time"
                                 status="{% if form.time_month.errors %}invalid{% else %}idle{% endif %}"
                                 validation-message="{{ form.time_month.errors|join:' ' }}"
                                 validation-icon="{% if form.time_month.errors %}exclamation-mark-triangle{% endif %}">
        <calcite-icon slot="label-content" id="time-month-tooltip" icon="information" scale="s"></calcite-icon>
      </calcite-input-time-picker>
    </div>
  </div>

  <div class="flex-container flex-column-gap-1">
    <div class="width-50">
      <calcite-select name="{{ form.ending_on.name }}" id="ending-on" value="{{ form.ending_on.value }}"
                      label-text="End On" required
                      status="{% if form.ending_on.errors %}invalid{% else %}idle{% endif %}"
                      validation-message="{{ form.ending_on.errors|join:' ' }}"
                      validation-icon="{% if form.ending_on.errors %}exclamation-mark-triangle{% endif %}"
                      label="End On">
        <calcite-icon slot="label-content" id="ending-on-tooltip" icon="information" scale="s"></calcite-icon>
        <calcite-option value="never" label="Never end">Never</calcite-option>
        <calcite-option value="date" label="End on specific date">Date</calcite-option>
      </calcite-select>
    </div>
    <div id="end-date-container" class="width-50" hidden>
      <calcite-input-date-picker type="date" name="ending_on_date" id="ending-on-date"
                                 {% if form.ending_on_date.value is None %}value=""
                                 {% else %}value="{{ form.ending_on_date.value }}"{% endif %}
                                 label-text="End Date" required
                                 min="{% now "Y-m-d" %}" label="End Date"
                                 status="{% if form.ending_on_date.errors %}invalid{% else %}idle{% endif %}"
                                 validation-message="{{ form.ending_on_date.errors|join:' ' }}"
                                 validation-icon="{% if form.ending_on_date.errors %}exclamation-mark-triangle{% endif %}">
        <calcite-icon slot="label-content" id="ending-on-date-tooltip" icon="information" scale="s"></calcite-icon>
      </calcite-input-date-picker>
    </div>
  </div>

  <calcite-combobox placeholder="Select items to refresh" id="{{ form.items.name }}" name="{{ form.items.name }}"
                    selection-mode="multiple" label-text="Items" required label="Items"
                    status="{% if form.items.errors %}invalid{% else %}idle{% endif %}"
                    validation-message="{{ form.items.errors|join:' ' }}"
                    validation-icon="{% if form.items.errors %}exclamation-mark-triangle{% endif %}">
    <calcite-icon slot="label-content" id="items-tooltip" icon="information" scale="s"></calcite-icon>
    <calcite-combobox-item icon="map" value="webmaps" text-label="Maps"
      {% if 'webmaps' in form.items.value %}selected{% endif %}></calcite-combobox-item>
    <calcite-combobox-item icon="layer-map-service" value="services"
                           text-label="Services/Layers"{% if 'services' in form.items.value %}
                           selected{% endif %}></calcite-combobox-item>
    <calcite-combobox-item icon="browser" value="webapps" text-label="Apps"
      {% if 'webapps' in form.items.value %}selected{% endif %}></calcite-combobox-item>
    <calcite-combobox-item icon="users" value="users" text-label="Users"
      {% if 'users' in form.items.value %}selected{% endif %}></calcite-combobox-item>
  </calcite-combobox>

  {% if form.non_field_errors %}
  <calcite-notice open kind="danger" icon>
    <div slot="message">{{ form.non_field_errors|join:" " }}</div>
  </calcite-notice>
  {% endif %}
</form>

<calcite-tooltip reference-element="beginning-on-tooltip" close-on-click placement="bottom-start">
  <span>The date when the schedule should start (cannot be in the past)</span>
</calcite-tooltip>
<calcite-tooltip reference-element="repeat-type-tooltip" close-on-click placement="bottom-start">
  <span>Select the frequency unit for the schedule (minute, hour, day, week, or month)</span>
</calcite-tooltip>
<calcite-tooltip reference-element="repeat-interval-minute-tooltip" close-on-click placement="bottom-start">
  <span>How often the schedule runs within the selected minute interval</span>
</calcite-tooltip>
<calcite-tooltip reference-element="days-of-week-minute-tooltip" close-on-click placement="bottom-start">
  <span>The days of the week the schedule should run for the selected minute interval</span>
</calcite-tooltip>
<calcite-tooltip reference-element="repeat-interval-hour-tooltip" close-on-click placement="bottom-start">
  <span>How often the schedule runs within the selected hour interval</span>
</calcite-tooltip>
<calcite-tooltip reference-element="days-of-week-hour-tooltip" close-on-click placement="bottom-start">
  <span>The days of the week the schedule should run for the selected hour interval</span>
</calcite-tooltip>
<calcite-tooltip reference-element="on-minute-tooltip" close-on-click placement="bottom-start">
  <span>The minute of the hour when the schedule should run</span>
</calcite-tooltip>
<calcite-tooltip reference-element="repeat-interval-day-tooltip" close-on-click placement="bottom-start">
  <span>How often the schedule runs within the selected day interval</span>
</calcite-tooltip>
<calcite-tooltip reference-element="time-day-tooltip" close-on-click placement="bottom-start">
  <span>The time of day when the schedule should run</span>
</calcite-tooltip>
<calcite-tooltip reference-element="days-of-week-week-tooltip" close-on-click placement="bottom-start">
  <span>The days of the week the schedule should run for the selected week interval</span>
</calcite-tooltip>
<calcite-tooltip reference-element="time-week-tooltip" close-on-click placement="bottom-start">
  <span>The time when the schedule should run on selected days</span>
</calcite-tooltip>
<calcite-tooltip reference-element="repeat-interval-month-tooltip" close-on-click placement="bottom-start">
  <span>How often the schedule runs within the selected month interval</span>
</calcite-tooltip>
<calcite-tooltip reference-element="day-of-month-tooltip" close-on-click placement="bottom-start">
  <span>The day of the month when the schedule should run (1-31). Note: Months with fewer days will use the last day of that month.</span>
</calcite-tooltip>
<calcite-tooltip reference-element="time-month-tooltip" close-on-click placement="bottom-start">
  <span>The time when the schedule should run on the selected day of the month</span>
</calcite-tooltip>
<calcite-tooltip reference-element="ending-on-tooltip" close-on-click placement="bottom-start">
  <span>Choose when the schedule should stop running (never or on a specific date)</span>
</calcite-tooltip>
<calcite-tooltip reference-element="ending-on-date-tooltip" close-on-click placement="bottom-start">
  <span>The date when the schedule should stop running (cannot be before the start date)</span>
</calcite-tooltip>
<calcite-tooltip reference-element="items-tooltip" close-on-click placement="bottom-start">
  <span>Select which portal items will be refreshed on this schedule (can select multiple)</span>
</calcite-tooltip>
