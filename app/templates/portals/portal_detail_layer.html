{% extends "app/base_site.html" %}


{% block title %} Webmaps {% endblock title %}


{% block stylesheets %}
    {{ block.super }}
    <style>
        .node {
            cursor: pointer;
        }

        .node circle {
            fill: #fff;
            stroke: #343a40;
            stroke-width: 1px;
        }

        .node text {
            font-size: 11px;
            fill: #3c3c3c;
        }

        .link {
            fill: none;
            stroke: #dcdcdc;
            stroke-width: 1px;
        }

        #viewDiv {
            height: 200px;
            width: 100%;
        }

        #chartd3 {
            height: 100%;
        }

        .d3chart {
            height: 400px;
        }
        .ghostCircle.show{
            display:block;
        }

        .ghostCircle, .activeDrag .ghostCircle{
            display: none;
        }
        .datatables-filter{
            float: right;
            margin-bottom: 8px;
        }
    </style>
{% endblock stylesheets %}

{% block content %}
    <div class="container body">
        <div class="main_container">
            <div class="right_col" role="main">
                <h1>{{ details.0.name }}</h1>
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-10 col-sm-10 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2><span class="fas fa-project-diagram"></span> What is this layer used in?<small>Matched
                                        based on layer name. May not be
                                        exact.</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fas fa-chevron-up"></i></a>
                                        </li>
                                        <li><a class="close-link"><i class="fas fa-times"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content d3chart">
                                    <div id="chartd3"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-12 col">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Quick Stats<small></small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fas fa-chevron-up"></i></a>
                                        </li>
                                        <li><a class="close-link"><i class="fas fa-times"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <h3>{{ details.1|length }}</h3>
                                    <small>Number of Map Services</small>
                                    <h3>{{ details.2|length }}</h3>
                                    <small>Number of Web Maps</small>
                                    <h3>{{ details.3|length }}</h3>
                                    <small>Number of Web Apps</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2><span class="fas fa-map-signs"></span> Web Services List</h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fas fa-chevron-up"></i></a>
                                        </li>
                                        <li><a class="close-link"><i class="fas fa-times"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                <div class="line">
                                    <div class="datatables-filter" id="datatable-services-filter"></div>
                                </div>
                                    <table id="datatable-services" class="table table-striped table-bordered"
                                           width="100%">
                                        <thead>
                                        <tr>
                                            <th class="details">Details</th>
                                            <th>Name</th>
                                            <th>URL</th>
                                            <th>Type</th>
                                            <th>Publishing Server</th>
                                            <th>GDB</th>
                                            <th class="instance">Instance</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for item in details.1 %}
                                            <tr>
                                                <td><a href="/portal/{{ item.instance }}/service/{{ item.name|urlencode:"" }}">
                                                    <button class="btn btn-secondary badge badge-dark" {% if item.instance is None %}
                                                    Disabled {% endif %}>More Information
                                                    </button>
                                            </a></td>
                                                <td>{{ item.name }}</td>
                                                <td>
                                                    <ul>{% for url in item.url.keys %}
                                                        <li>{{ url }}</li>{% endfor %}</ul>
                                                </td>
                                                <td>{{ item.type }}</td>
                                                <td>{{ item.owner }}</td>
                                                <td>{{ item.database }}</td>
                                                <td>{{ item.instance }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2><span class="fas fa-history"></span> Web Services Usage<small>Last 30
                                        days</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fas fa-chevron-up"></i></a>
                                        </li>
                                        <li><a class="close-link"><i class="fas fa-times"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <canvas id="line-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2><span class="far fa-map"></span> Web Map List</h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fas fa-chevron-up"></i></a>
                                        </li>
                                        <li><a class="close-link"><i class="fas fa-times"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                <div class="line">
                                    <div class="datatables-filter" id="datatable-maps-filter"></div>
                                </div>
                                    <table id="datatable-maps" class="table table-striped table-bordered" width="100%">
                                        <thead>
                                        <tr>
                                            <th class="details">Details</th>
                                            <th>Webmap Title</th>
                                            <th>URL</th>
                                            <th>Owner</th>
                                            <th>Access</th>
                                            <th>Created</th>
                                            <th>Modified</th>
                                            <th>Views</th>
                                            <th class="instance">Instance</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for item in details.2 %}
                                            <tr>
                                                <td><a href=/portal/{{ item.instance }}/map/{{ item.database }}>
                                                    <button class="btn btn-secondary badge badge-dark">More Information
                                                    </button>
                                                </a></td>
                                                <td>{{ item.name }}</td>
                                                <td>{{ item.url }}</td>
                                                <td>{{ item.owner }}</td>
                                                <td>{{ item.access }}</td>
                                                <td>{{ item.created }}</td>
                                                <td>{{ item.modified }}</td>
                                                <td>{{ item.views }}</td>
                                                <td>{{ item.instance }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2><span class="fas fa-th"></span> Web App List<small>Web Mapping Application &
                                        Dashboard</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fas fa-chevron-up"></i></a>
                                        </li>
                                        <li><a class="close-link"><i class="fas fa-times"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                <div class="line">
                                    <div class="datatables-filter" id="datatable-apps-filter"></div>
                                </div>
                                    <table id="datatable-apps" class="table table-striped table-bordered" width="100%">
                                        <thead>
                                        <tr>
                                            <th>Web App Title</th>
                                            <th>URL</th>
                                            <th>Owner</th>
                                            <th>Access</th>
                                            <th>Created</th>
                                            <th>Modified</th>
                                            <th>Views</th>
                                            <th class="instance">Instance</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for item in details.3 %}
                                            <tr>
                                                <td>{{ item.name }}</td>
                                                <td>{{ item.url }}</td>
                                                <td>{{ item.owner }}</td>
                                                <td>{{ item.access }}</td>
                                                <td>{{ item.created }}</td>
                                                <td>{{ item.modified }}</td>
                                                <td>{{ item.views }}</td>
                                                <td>{{ item.instance }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block javascripts %}
    {{ block.super }}
    <script src="https://cdn.jsdelivr.net/npm/d3@3.0.0/d3.min.js"
            integrity="sha256-b69VTDu5tPmoLspoBD0rxTFiimxoTONDLrAgF68zU8c=" crossorigin="anonymous"></script>
{#    <script src="https://d3js.org/d3.v3.min.js"></script>#}
    {{ details.0|json_script:"d3data" }}
    <script type="text/javascript" src="/static/build/js/d3chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"
            integrity="sha256-t9UJPrESBeG2ojKTIcFLPGF7nHi2vEc7f5A2KpH/UBU=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes@0.4.0/dist/chartjs-plugin-colorschemes.min.js"
            integrity="sha256-Ctym065YsaugUvysT5nHayKynbiDGVpgNBqUePRAL+0=" crossorigin="anonymous"></script>
    {{ service_usage|json_script:"chartdata" }}
    <script>init_Charts()</script>

{% endblock javascripts %}